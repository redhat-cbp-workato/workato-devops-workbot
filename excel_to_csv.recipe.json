{
  "name": "Excel_to_CSV",
  "description": "",
  "version": 1,
  "private": true,
  "concurrency": 1,
  "code": {
    "number": 0,
    "provider": "workato_recipe_function",
    "name": "execute",
    "as": "a5d79a54",
    "keyword": "trigger",
    "input": {
      "parameters_schema_json": "[{\"name\":\"file_content\",\"type\":\"string\",\"optional\":false,\"label\":\"file_content\",\"control_type\":\"text\"},{\"name\":\"sheet_name\",\"type\":\"string\",\"optional\":false,\"label\":\"sheet_name\",\"control_type\":\"text\"},{\"name\":\"record_id\",\"type\":\"string\",\"optional\":false,\"label\":\"record_id\",\"control_type\":\"text\"},{\"name\":\"record_type_id\",\"type\":\"string\",\"optional\":true,\"label\":\"record_type_id\",\"control_type\":\"text\"}]",
      "result_schema_json": "[{\"name\":\"csv_data\",\"type\":\"string\",\"optional\":false,\"label\":\"csv_data\",\"control_type\":\"text\"},{\"name\":\"error\",\"type\":\"string\",\"optional\":true,\"label\":\"error\",\"control_type\":\"text\"}]"
    },
    "extended_output_schema": [
      {
        "label": "Parameters",
        "name": "parameters",
        "properties": [
          {
            "control_type": "text",
            "label": "file_content",
            "name": "file_content",
            "type": "string",
            "optional": false
          },
          {
            "control_type": "text",
            "label": "sheet_name",
            "name": "sheet_name",
            "type": "string",
            "optional": false
          },
          {
            "control_type": "text",
            "label": "record_id",
            "name": "record_id",
            "type": "string",
            "optional": false
          },
          {
            "control_type": "text",
            "label": "record_type_id",
            "name": "record_type_id",
            "type": "string",
            "optional": true
          }
        ],
        "type": "object"
      }
    ],
    "block": [
      {
        "number": 1,
        "provider": "py_eval",
        "name": "invoke_custom_py_code",
        "as": "7a28d69b",
        "keyword": "action",
        "input": {
          "code": "import pandas as pd\nimport io\n\ndef main(input):\n    try:\n        # Inputs\n        binary_data = input.get('file_content')\n        sheet_name = input.get('sheet_name') \n        record_id = input.get('record_id')\n        record_type_id = input.get('record_type_id')\n\n        # Check for empty file\n        if not binary_data:\n            return {\"csv_data\": \"\", \"error\": \"No file content\"}\n\n        # Check for missing Sheet Name\n        if not sheet_name:\n            return {\"csv_data\": \"\", \"error\": \"Input Error: 'sheet_name' is required.\"}\n\n        # Maps Sheet Name -> Exact Column List\n        strict_schemas = {\n            \"SKU List\": [\n                \"SKU\", \"SKU Description\", \"Product\", \"Category\", \n                \"Region\", \"Country\", \"Currency\", \"List Price\", \"Training Unit\", \n                \"Training Modality\", \"Included Course & Exam SKU\",\n                \"Billing Type\", \"Service Term\", \"Support Level\", \n                \"Support Type\", \"Unit of Measure\", \"Cores\", \n                \"Nodes\", \"Sockets\", \"Virtual Guests\"\n            ],\n            \"Change Summary\":[\"SKU\", \"Billing Type\", \"Category\", \"Change Details\",\n\"Change Type\", \"Cores\", \"Currency\", \"Country\", \"Included Course & Exam SKU\", \"List Price\",\n\"Nodes\", \"Product\", \"Region\", \"Service Term\",\n\"SKU Description\", \"Sockets\", \"Support Level\", \"Support Type\",\n\"Training Modality\", \"Training Unit\", \"Unit of Measure\", \"Virtual Guests\"],\n            \"Product Notes\":[\"Product Name\",\"Notes\"]\n        }\n\n        # Load Excel Wrapper\n        excel_file = pd.ExcelFile(io.BytesIO(binary_data))\n\n        # Check if Tab/Sheet exists in the file\n        if isinstance(sheet_name, str) and sheet_name not in excel_file.sheet_names:\n            return {\n                \"csv_data\": \"\", \n                \"error\": f\"Tab Error: Sheet '{sheet_name}' not found. Available sheets: {excel_file.sheet_names}\"\n            }\n\n        # Read Data\n        df = pd.read_excel(excel_file, sheet_name=sheet_name, header=0,keep_default_na=False)\n\n        # Look up schema based on the Sheet Name provided\n        required_columns = strict_schemas.get(sheet_name)\n        \n        if required_columns:\n            # Check for Missing Columns\n            missing_cols = list(set(required_columns) - set(df.columns))\n            if missing_cols:\n                return {\n                    \"csv_data\": \"\", \n                    \"error\": f\"Schema Error: Missing columns in '{sheet_name}': {missing_cols}\"\n                }\n\n            # Enforce Strict Order (Drops extra cols, adds missing as NaN)\n            df = df.reindex(columns=required_columns)\n\n        # Metadata Injection\n        if record_id:\n            df[\"Record_Id\"] = record_id\n        if record_type_id:\n            df[\"Record_Type_Id\"] = record_type_id\n\n        # Output\n        return {\n            \"csv_data\": df.to_csv(index=False), \n            \"error\": None\n        }\n\n    except Exception as e:\n        # Catch ANY error (syntax, pandas, logic) and return as JSON\n        return {\"csv_data\": \"\", \"error\": f\"Script Error: {str(e)}\"}",
          "name": "Get_Csv_String",
          "code_input": {
            "schema": "[{\"control_type\":\"text\",\"label\":\"file_content\",\"name\":\"file_content\",\"type\":\"string\",\"optional\":true,\"details\":{\"real_name\":\"file_content\"},\"parent\":[\"code_input\",\"data\"]},{\"control_type\":\"text\",\"label\":\"sheet_name\",\"name\":\"sheet_name\",\"type\":\"string\",\"optional\":true,\"details\":{\"real_name\":\"sheet_name\"},\"parent\":[\"code_input\",\"data\"]},{\"control_type\":\"text\",\"label\":\"record_id\",\"name\":\"record_id\",\"type\":\"string\",\"optional\":true,\"details\":{\"real_name\":\"record_id\"},\"parent\":[\"code_input\",\"data\"]},{\"name\":\"record_type_id\",\"type\":\"string\",\"optional\":true,\"label\":\"record_type_id\",\"details\":{\"real_name\":\"record_type_id\"},\"control_type\":\"text\",\"parent\":[\"code_input\",\"data\"]}]",
            "data": {
              "file_content": "#{_dp('{\"pill_type\":\"output\",\"provider\":\"workato_recipe_function\",\"line\":\"a5d79a54\",\"path\":[\"parameters\",\"file_content\"]}')}",
              "sheet_name": "#{_dp('{\"pill_type\":\"output\",\"provider\":\"workato_recipe_function\",\"line\":\"a5d79a54\",\"path\":[\"parameters\",\"sheet_name\"]}')}",
              "record_id": "#{_dp('{\"pill_type\":\"output\",\"provider\":\"workato_recipe_function\",\"line\":\"a5d79a54\",\"path\":[\"parameters\",\"record_id\"]}')}",
              "record_type_id": "#{_dp('{\"pill_type\":\"output\",\"provider\":\"workato_recipe_function\",\"line\":\"a5d79a54\",\"path\":[\"parameters\",\"record_type_id\"]}')}"
            }
          },
          "code_output_schema_json": "[{\"name\":\"csv_data\",\"type\":\"string\",\"optional\":false,\"label\":\"csv_data\",\"control_type\":\"text\"},{\"name\":\"error\",\"type\":\"string\",\"optional\":true,\"label\":\"error\",\"control_type\":\"text\"}]"
        },
        "extended_output_schema": [
          {
            "label": "Output",
            "name": "output",
            "properties": [
              {
                "control_type": "text",
                "label": "csv_data",
                "name": "csv_data",
                "type": "string",
                "optional": false
              },
              {
                "control_type": "text",
                "label": "error",
                "name": "error",
                "type": "string",
                "optional": true
              }
            ],
            "type": "object"
          }
        ],
        "extended_input_schema": [
          {
            "control_type": "form-schema-builder",
            "hint": "Define the input fields that will be passed to your Python code",
            "label": "Input fields",
            "name": "code_input",
            "optional": true,
            "override": true,
            "properties": [
              {
                "control_type": "text",
                "label": "Schema",
                "extends_schema": true,
                "type": "string",
                "name": "schema"
              },
              {
                "properties": [
                  {
                    "control_type": "text",
                    "label": "file_content",
                    "name": "file_content",
                    "type": "string",
                    "optional": true,
                    "details": {
                      "real_name": "file_content"
                    },
                    "parent": [
                      "code_input",
                      "data"
                    ]
                  },
                  {
                    "control_type": "text",
                    "label": "sheet_name",
                    "name": "sheet_name",
                    "type": "string",
                    "optional": true,
                    "details": {
                      "real_name": "sheet_name"
                    },
                    "parent": [
                      "code_input",
                      "data"
                    ]
                  },
                  {
                    "control_type": "text",
                    "label": "record_id",
                    "name": "record_id",
                    "type": "string",
                    "optional": true,
                    "details": {
                      "real_name": "record_id"
                    },
                    "parent": [
                      "code_input",
                      "data"
                    ]
                  },
                  {
                    "control_type": "text",
                    "label": "record_type_id",
                    "name": "record_type_id",
                    "type": "string",
                    "optional": true,
                    "details": {
                      "real_name": "record_type_id"
                    },
                    "parent": [
                      "code_input",
                      "data"
                    ]
                  }
                ],
                "label": "Data",
                "type": "object",
                "name": "data"
              }
            ],
            "sticky": true,
            "type": "object"
          }
        ],
        "visible_config_fields": [
          "name",
          "code_input",
          "code_output_schema_json",
          "code",
          "code_input.data.file_content",
          "code_input.schema",
          "code_input.data.sheet_name",
          "code_input.data",
          "code_input.data.record_id",
          "code_input.data.record_type_id"
        ],
        "uuid": "54547322-3ea4-467d-95e5-fc1c652e103e"
      },
      {
        "number": 2,
        "provider": "workato_recipe_function",
        "name": "return_result",
        "as": "571fb83c",
        "keyword": "action",
        "input": {
          "result": {
            "csv_data": "#{_dp('{\"pill_type\":\"output\",\"provider\":\"py_eval\",\"line\":\"7a28d69b\",\"path\":[\"output\",\"csv_data\"]}')}",
            "error": "#{_dp('{\"pill_type\":\"output\",\"provider\":\"py_eval\",\"line\":\"7a28d69b\",\"path\":[\"output\",\"error\"]}')}"
          }
        },
        "extended_output_schema": [
          {
            "label": "Result",
            "name": "result",
            "properties": [
              {
                "control_type": "text",
                "label": "csv_data",
                "name": "csv_data",
                "type": "string",
                "optional": false
              },
              {
                "control_type": "text",
                "label": "error",
                "name": "error",
                "type": "string",
                "optional": true
              }
            ],
            "type": "object"
          }
        ],
        "extended_input_schema": [
          {
            "label": "Result",
            "name": "result",
            "properties": [
              {
                "control_type": "text",
                "label": "csv_data",
                "name": "csv_data",
                "type": "string",
                "optional": false
              },
              {
                "control_type": "text",
                "label": "error",
                "name": "error",
                "type": "string",
                "optional": true
              }
            ],
            "type": "object"
          }
        ],
        "visible_config_fields": [
          "result",
          "result.csv_data",
          "result.error"
        ],
        "uuid": "dc8f7b6e-8ed3-431d-a6a0-87c783393d40"
      }
    ],
    "uuid": "42988d4e-ccf6-4e31-b982-b7feb5135844"
  },
  "config": [
    {
      "keyword": "application",
      "provider": "workato_recipe_function",
      "skip_validation": false,
      "account_id": null
    },
    {
      "keyword": "application",
      "provider": "py_eval",
      "skip_validation": false,
      "account_id": null
    }
  ]
}